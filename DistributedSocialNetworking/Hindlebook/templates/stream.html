{% extends "base_header.html" %}
{% load staticfiles %}


{% block page %}

<div class="container">

    <!-- New Post Form -->
	<div class="row">
		<form id="post-form" method="post" action=".">
            {% include "post_form.html" %}
		</form>
	</div> <!-- /row -->
    <!-- /EndNewPostForm -->

    <div id="stream">
	{% for post in posts %}
		{% include "post.html" %}
            <!--
				{% for comment in post.getComments %}
				<div class="row">
					<div class="well">
						<div class="row"><h5><b>{{ comment.author.username }} - {{ comment.pub_date }}</b></h5></div>
						<div class="row">{{ comment.text}}</div>
					</div>
				</div>
				{% endfor %}
				<form action="posts/{{ post.uuid }}" method="post" autocomplete="off">
					{% csrf_token %}
					{{ comment_form.as_bootstrap_form }}
					<input type="submit" name="new_comment" value="Add comment" />
				</form> -->
	{% endfor %}
    </div> <!-- /stream -->
</div> <!-- /container --->
{% endblock %}

{% block scripts %}
<script>
    var base_url = "/post/create/";
    var form_options = {
        success: postSuccess,
        dataType: "json",
        error: ajaxError,
        clearForm : false,
        type : "PUT",
        beforeSubmit : beforeSubmit
    }

    $('#post-form').ajaxForm(form_options);

    function beforeSubmit(arr, $form, options) {
        console.log(options["url"]);
        options["url"] = base_url + $("#uuid").val();
        console.log(options["url"]);
    }

    function postSuccess(response, status, xhr, form) {
        console.log("Form was valid!");
        $('#post-form').html(response["form"]);
        $('#post-form').clearForm();
        $('#stream').prepend(response["post"]);
    }

    function ajaxError(xhr, errmsg, err) {
        var response;
        console.log(xhr.status + ": " + xhr.responseText);
        response = JSON.parse(xhr.responseText);
        $('#post-form').html(response["form"]);
    }
</script>
{% endblock scripts %}